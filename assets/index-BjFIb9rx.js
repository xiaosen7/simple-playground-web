var Dn=Object.defineProperty;var qn=(e,n,t)=>n in e?Dn(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var v=(e,n,t)=>(qn(e,typeof n!="symbol"?n+"":n,t),t),he=(e,n,t)=>{if(!n.has(e))throw TypeError("Cannot "+t)};var a=(e,n,t)=>(he(e,n,"read from private field"),t?t.call(e):n.get(e)),p=(e,n,t)=>{if(n.has(e))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(e):n.set(e,t)},C=(e,n,t,r)=>(he(e,n,"write to private field"),r?r.call(e,t):n.set(e,t),t);var qe=(e,n,t)=>(he(e,n,"access private method"),t);import{r as je,R as pe}from"./index-CBqU2yxZ.js";import{s as Un,o as Gn,l as ke,i as J,n as en,q as _e,u as Pe,v as Oe,M as Nn,S as Ue,U as Ge,w as Ne,x as Be,y as me,z as X,A as nn,B as W,C as we,D as Bn,E as Ie,F as ce,G as Hn,H as xe,I as tn,J as Kn,K as Jn,L as rn,N as Wn,O as Yn,P as Qn,Q as Xn,R as Zn,T as zn,V as Vn,W as jn,X as kn,f as et,Y as x,Z as k,$ as nt,a0 as Z,a1 as de,a2 as sn,_ as Te,a3 as tt,a4 as rt,a5 as R,a6 as an,a7 as it,a8 as on,a9 as ve,aa as st,ab as at,ac as ot,ad as ut,ae as lt,af as fe,ag as un,ah as He,ai as ct,p as g,aj as ln,ak as dt,j as G,al as O,am as cn,an as ft,b as Ke,ao as ht,ap as vt}from"./FileSaver.min-bqrOd9w_.js";const Re=je.createContext(null);function yt(e,n){return Un(Gn(e,n,ke),e+"")}function gt(e,n,t){if(!J(t))return!1;var r=typeof n;return(r=="number"?en(t)&&_e(n,t.length):r=="string"&&n in t)?Pe(t[n],e):!1}function pt(e){return yt(function(n,t){var r=-1,i=t.length,s=i>1?t[i-1]:void 0,o=i>2?t[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&gt(t[0],t[1],o)&&(s=i<3?void 0:s,i=1),n=Object(n);++r<i;){var l=t[r];l&&e(n,l,r,s)}return n})}function mt(e,n,t){var r=e==null?void 0:Oe(e,n);return r===void 0?t:r}var wt="__lodash_hash_undefined__";function xt(e){return this.__data__.set(e,wt),this}function bt(e){return this.__data__.has(e)}function ie(e){var n=-1,t=e==null?0:e.length;for(this.__data__=new Nn;++n<t;)this.add(e[n])}ie.prototype.add=ie.prototype.push=xt;ie.prototype.has=bt;function Et(e,n){for(var t=-1,r=e==null?0:e.length;++t<r;)if(n(e[t],t,e))return!0;return!1}function At(e,n){return e.has(n)}var St=1,$t=2;function dn(e,n,t,r,i,s){var o=t&St,l=e.length,u=n.length;if(l!=u&&!(o&&u>l))return!1;var c=s.get(e),d=s.get(n);if(c&&d)return c==n&&d==e;var f=-1,h=!0,y=t&$t?new ie:void 0;for(s.set(e,n),s.set(n,e);++f<l;){var w=e[f],b=n[f];if(r)var $=o?r(b,w,f,n,e,s):r(w,b,f,e,n,s);if($!==void 0){if($)continue;h=!1;break}if(y){if(!Et(n,function(_,P){if(!At(y,P)&&(w===_||i(w,_,t,r,s)))return y.push(P)})){h=!1;break}}else if(!(w===b||i(w,b,t,r,s))){h=!1;break}}return s.delete(e),s.delete(n),h}function _t(e){var n=-1,t=Array(e.size);return e.forEach(function(r,i){t[++n]=[i,r]}),t}function Pt(e){var n=-1,t=Array(e.size);return e.forEach(function(r){t[++n]=r}),t}var Ot=1,It=2,Tt="[object Boolean]",Rt="[object Date]",Lt="[object Error]",Ct="[object Map]",Ft="[object Number]",Mt="[object RegExp]",Dt="[object Set]",qt="[object String]",Ut="[object Symbol]",Gt="[object ArrayBuffer]",Nt="[object DataView]",Je=Ue?Ue.prototype:void 0,ye=Je?Je.valueOf:void 0;function Bt(e,n,t,r,i,s,o){switch(t){case Nt:if(e.byteLength!=n.byteLength||e.byteOffset!=n.byteOffset)return!1;e=e.buffer,n=n.buffer;case Gt:return!(e.byteLength!=n.byteLength||!s(new Ge(e),new Ge(n)));case Tt:case Rt:case Ft:return Pe(+e,+n);case Lt:return e.name==n.name&&e.message==n.message;case Mt:case qt:return e==n+"";case Ct:var l=_t;case Dt:var u=r&Ot;if(l||(l=Pt),e.size!=n.size&&!u)return!1;var c=o.get(e);if(c)return c==n;r|=It,o.set(e,n);var d=dn(l(e),l(n),r,i,s,o);return o.delete(e),d;case Ut:if(ye)return ye.call(e)==ye.call(n)}return!1}var Ht=1,Kt=Object.prototype,Jt=Kt.hasOwnProperty;function Wt(e,n,t,r,i,s){var o=t&Ht,l=Ne(e),u=l.length,c=Ne(n),d=c.length;if(u!=d&&!o)return!1;for(var f=u;f--;){var h=l[f];if(!(o?h in n:Jt.call(n,h)))return!1}var y=s.get(e),w=s.get(n);if(y&&w)return y==n&&w==e;var b=!0;s.set(e,n),s.set(n,e);for(var $=o;++f<u;){h=l[f];var _=e[h],P=n[h];if(r)var De=o?r(P,_,h,n,e,s):r(_,P,h,e,n,s);if(!(De===void 0?_===P||i(_,P,t,r,s):De)){b=!1;break}$||($=h=="constructor")}if(b&&!$){var ee=e.constructor,ne=n.constructor;ee!=ne&&"constructor"in e&&"constructor"in n&&!(typeof ee=="function"&&ee instanceof ee&&typeof ne=="function"&&ne instanceof ne)&&(b=!1)}return s.delete(e),s.delete(n),b}var Yt=1,We="[object Arguments]",Ye="[object Array]",te="[object Object]",Qt=Object.prototype,Qe=Qt.hasOwnProperty;function Xt(e,n,t,r,i,s){var o=W(e),l=W(n),u=o?Ye:Be(e),c=l?Ye:Be(n);u=u==We?te:u,c=c==We?te:c;var d=u==te,f=c==te,h=u==c;if(h&&me(e)){if(!me(n))return!1;o=!0,d=!1}if(h&&!d)return s||(s=new X),o||nn(e)?dn(e,n,t,r,i,s):Bt(e,n,u,t,r,i,s);if(!(t&Yt)){var y=d&&Qe.call(e,"__wrapped__"),w=f&&Qe.call(n,"__wrapped__");if(y||w){var b=y?e.value():e,$=w?n.value():n;return s||(s=new X),i(b,$,t,r,s)}}return h?(s||(s=new X),Wt(e,n,t,r,i,s)):!1}function Le(e,n,t,r,i){return e===n?!0:e==null||n==null||!we(e)&&!we(n)?e!==e&&n!==n:Xt(e,n,t,r,Le,i)}var Zt=1,zt=2;function Vt(e,n,t,r){var i=t.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=t[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=t[i];var l=o[0],u=e[l],c=o[1];if(o[2]){if(u===void 0&&!(l in e))return!1}else{var d=new X,f;if(!(f===void 0?Le(c,u,Zt|zt,r,d):f))return!1}}return!0}function fn(e){return e===e&&!J(e)}function jt(e){for(var n=Bn(e),t=n.length;t--;){var r=n[t],i=e[r];n[t]=[r,i,fn(i)]}return n}function hn(e,n){return function(t){return t==null?!1:t[e]===n&&(n!==void 0||e in Object(t))}}function kt(e){var n=jt(e);return n.length==1&&n[0][2]?hn(n[0][0],n[0][1]):function(t){return t===e||Vt(t,e,n)}}function er(e,n){return e!=null&&n in Object(e)}function nr(e,n,t){n=Ie(n,e);for(var r=-1,i=n.length,s=!1;++r<i;){var o=ce(n[r]);if(!(s=e!=null&&t(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&Hn(i)&&_e(o,i)&&(W(e)||xe(e)))}function tr(e,n){return e!=null&&nr(e,n,er)}var rr=1,ir=2;function sr(e,n){return tn(e)&&fn(n)?hn(ce(e),n):function(t){var r=mt(t,e);return r===void 0&&r===n?tr(t,e):Le(n,r,rr|ir)}}function ar(e){return function(n){return n==null?void 0:n[e]}}function or(e){return function(n){return Oe(n,e)}}function ur(e){return tn(e)?ar(ce(e)):or(e)}function vn(e){return typeof e=="function"?e:e==null?ke:typeof e=="object"?W(e)?sr(e[0],e[1]):kt(e):ur(e)}function lr(e){return function(n,t,r){for(var i=-1,s=Object(n),o=r(n),l=o.length;l--;){var u=o[++i];if(t(s[u],u,s)===!1)break}return n}}var cr=lr();function be(e,n,t){(t!==void 0&&!Pe(e[n],t)||t===void 0&&!(n in e))&&Kn(e,n,t)}function dr(e){return we(e)&&en(e)}function Ee(e,n){if(!(n==="constructor"&&typeof e[n]=="function")&&n!="__proto__")return e[n]}function fr(e){return Jn(e,rn(e))}function hr(e,n,t,r,i,s,o){var l=Ee(e,t),u=Ee(n,t),c=o.get(u);if(c){be(e,t,c);return}var d=s?s(l,u,t+"",e,n,o):void 0,f=d===void 0;if(f){var h=W(u),y=!h&&me(u),w=!h&&!y&&nn(u);d=u,h||y||w?W(l)?d=l:dr(l)?d=Wn(l):y?(f=!1,d=Yn(u,!0)):w?(f=!1,d=Qn(u,!0)):d=[]:Xn(u)||xe(u)?(d=l,xe(l)?d=fr(l):(!J(l)||Zn(l))&&(d=zn(u))):f=!1}f&&(o.set(u,d),i(d,u,r,s,o),o.delete(u)),be(e,t,d)}function yn(e,n,t,r,i){e!==n&&cr(n,function(s,o){if(i||(i=new X),J(s))hr(e,n,o,t,yn,r,i);else{var l=r?r(Ee(e,o),s,o+"",e,n,i):void 0;l===void 0&&(l=s),be(e,o,l)}},rn)}function vr(e){return e==null}var yr=pt(function(e,n,t){yn(e,n,t)}),gr="Expected a function";function pr(e){if(typeof e!="function")throw new TypeError(gr);return function(){var n=arguments;switch(n.length){case 0:return!e.call(this);case 1:return!e.call(this,n[0]);case 2:return!e.call(this,n[0],n[1]);case 3:return!e.call(this,n[0],n[1],n[2])}return!e.apply(this,n)}}function gn(e,n,t,r){if(!J(e))return e;n=Ie(n,e);for(var i=-1,s=n.length,o=s-1,l=e;l!=null&&++i<s;){var u=ce(n[i]),c=t;if(u==="__proto__"||u==="constructor"||u==="prototype")return e;if(i!=o){var d=l[u];c=void 0,c===void 0&&(c=J(d)?d:_e(n[i+1])?[]:{})}Vn(l,u,c),l=l[u]}return e}function mr(e,n,t){for(var r=-1,i=n.length,s={};++r<i;){var o=n[r],l=Oe(e,o);t(l,o)&&gn(s,Ie(o,e),l)}return s}function wr(e,n){if(e==null)return{};var t=jn(kn(e),function(r){return[r]});return n=vn(n),mr(e,t,function(r,i){return n(r,i[0])})}function xr(e,n){return wr(e,pr(vn(n)))}function Xe(e,n,t){return e==null?e:gn(e,n,t)}var br=0;function Er(e){var n=++br;return et(e)+n}function Ar(e){return x(e==null?void 0:e.lift)}function Q(e){return function(n){if(Ar(n))return n.lift(function(t){try{return e(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Y(e,n,t,r,i){return new Sr(e,n,t,r,i)}var Sr=function(e){k(n,e);function n(t,r,i,s,o,l){var u=e.call(this,t)||this;return u.onFinalize=o,u.shouldUnsubscribe=l,u._next=r?function(c){try{r(c)}catch(d){t.error(d)}}:e.prototype._next,u._error=s?function(c){try{s(c)}catch(d){t.error(d)}finally{this.unsubscribe()}}:e.prototype._error,u._complete=i?function(){try{i()}catch(c){t.error(c)}finally{this.unsubscribe()}}:e.prototype._complete,u}return n.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},n}(nt),re=function(e){k(n,e);function n(t){var r=e.call(this)||this;return r._value=t,r}return Object.defineProperty(n.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),n.prototype._subscribe=function(t){var r=e.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},n.prototype.getValue=function(){var t=this,r=t.hasError,i=t.thrownError,s=t._value;if(r)throw i;return this._throwIfClosed(),s},n.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},n}(Z),$r=function(e){k(n,e);function n(t,r){return e.call(this)||this}return n.prototype.schedule=function(t,r){return this},n}(de),Ae={setInterval:function(e,n){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];return setInterval.apply(void 0,sn([e,n],Te(t)))},clearInterval:function(e){var n=Ae.delegate;return((n==null?void 0:n.clearInterval)||clearInterval)(e)},delegate:void 0},_r=function(e){k(n,e);function n(t,r){var i=e.call(this,t,r)||this;return i.scheduler=t,i.work=r,i.pending=!1,i}return n.prototype.schedule=function(t,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=t;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},n.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),Ae.setInterval(t.flush.bind(t,this),i)},n.prototype.recycleAsyncId=function(t,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&Ae.clearInterval(r)},n.prototype.execute=function(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},n.prototype._execute=function(t,r){var i=!1,s;try{this.work(t)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},n.prototype.unsubscribe=function(){if(!this.closed){var t=this,r=t.id,i=t.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,tt(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},n}($r),Ze=function(){function e(n,t){t===void 0&&(t=e.now),this.schedulerActionCtor=n,this.now=t}return e.prototype.schedule=function(n,t,r){return t===void 0&&(t=0),new this.schedulerActionCtor(this,n).schedule(r,t)},e.now=rt.now,e}(),Pr=function(e){k(n,e);function n(t,r){r===void 0&&(r=Ze.now);var i=e.call(this,t,r)||this;return i.actions=[],i._active=!1,i}return n.prototype.flush=function(t){var r=this.actions;if(this._active){r.push(t);return}var i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=r.shift());if(this._active=!1,i){for(;t=r.shift();)t.unsubscribe();throw i}},n}(Ze),Or=new Pr(_r),Ir=new R(function(e){return e.complete()});function Tr(e){return e&&x(e.schedule)}function pn(e){return e[e.length-1]}function Rr(e){return Tr(pn(e))?e.pop():void 0}function Lr(e,n){return typeof pn(e)=="number"?e.pop():n}var Ce=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function mn(e){return x(e==null?void 0:e.then)}function wn(e){return x(e[an])}function xn(e){return Symbol.asyncIterator&&x(e==null?void 0:e[Symbol.asyncIterator])}function bn(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Cr(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var En=Cr();function An(e){return x(e==null?void 0:e[En])}function Sn(e){return it(this,arguments,function(){var t,r,i,s;return on(this,function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,ve(t.read())];case 3:return r=o.sent(),i=r.value,s=r.done,s?[4,ve(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,ve(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function $n(e){return x(e==null?void 0:e.getReader)}function U(e){if(e instanceof R)return e;if(e!=null){if(wn(e))return Fr(e);if(Ce(e))return Mr(e);if(mn(e))return Dr(e);if(xn(e))return _n(e);if(An(e))return qr(e);if($n(e))return Ur(e)}throw bn(e)}function Fr(e){return new R(function(n){var t=e[an]();if(x(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Mr(e){return new R(function(n){for(var t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}function Dr(e){return new R(function(n){e.then(function(t){n.closed||(n.next(t),n.complete())},function(t){return n.error(t)}).then(null,st)})}function qr(e){return new R(function(n){var t,r;try{for(var i=at(e),s=i.next();!s.done;s=i.next()){var o=s.value;if(n.next(o),n.closed)return}}catch(l){t={error:l}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}n.complete()})}function _n(e){return new R(function(n){Gr(e,n).catch(function(t){return n.error(t)})})}function Ur(e){return _n(Sn(e))}function Gr(e,n){var t,r,i,s;return ot(this,void 0,void 0,function(){var o,l;return on(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),t=ut(e),u.label=1;case 1:return[4,t.next()];case 2:if(r=u.sent(),!!r.done)return[3,4];if(o=r.value,n.next(o),n.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return l=u.sent(),i={error:l},[3,11];case 6:return u.trys.push([6,,9,10]),r&&!r.done&&(s=t.return)?[4,s.call(t)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return n.complete(),[2]}})})}function q(e,n,t,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=n.schedule(function(){t(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(s),!i)return s}function Pn(e,n){return n===void 0&&(n=0),Q(function(t,r){t.subscribe(Y(r,function(i){return q(r,e,function(){return r.next(i)},n)},function(){return q(r,e,function(){return r.complete()},n)},function(i){return q(r,e,function(){return r.error(i)},n)}))})}function On(e,n){return n===void 0&&(n=0),Q(function(t,r){r.add(e.schedule(function(){return t.subscribe(r)},n))})}function Nr(e,n){return U(e).pipe(On(n),Pn(n))}function Br(e,n){return U(e).pipe(On(n),Pn(n))}function Hr(e,n){return new R(function(t){var r=0;return n.schedule(function(){r===e.length?t.complete():(t.next(e[r++]),t.closed||this.schedule())})})}function Kr(e,n){return new R(function(t){var r;return q(t,n,function(){r=e[En](),q(t,n,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(l){t.error(l);return}o?t.complete():t.next(s)},0,!0)}),function(){return x(r==null?void 0:r.return)&&r.return()}})}function In(e,n){if(!e)throw new Error("Iterable cannot be null");return new R(function(t){q(t,n,function(){var r=e[Symbol.asyncIterator]();q(t,n,function(){r.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}function Jr(e,n){return In(Sn(e),n)}function Wr(e,n){if(e!=null){if(wn(e))return Nr(e,n);if(Ce(e))return Hr(e,n);if(mn(e))return Br(e,n);if(xn(e))return In(e,n);if(An(e))return Kr(e,n);if($n(e))return Jr(e,n)}throw bn(e)}function Yr(e,n){return n?Wr(e,n):U(e)}function Tn(e,n){return Q(function(t,r){var i=0;t.subscribe(Y(r,function(s){r.next(e.call(n,s,i++))}))})}var Qr=Array.isArray;function Xr(e,n){return Qr(n)?e.apply(void 0,sn([],Te(n))):e(n)}function Zr(e){return Tn(function(n){return Xr(e,n)})}function zr(e,n,t,r,i,s,o,l){var u=[],c=0,d=0,f=!1,h=function(){f&&!u.length&&!c&&n.complete()},y=function(b){return c<r?w(b):u.push(b)},w=function(b){c++;var $=!1;U(t(b,d++)).subscribe(Y(n,function(_){n.next(_)},function(){$=!0},void 0,function(){if($)try{c--;for(var _=function(){var P=u.shift();o||w(P)};u.length&&c<r;)_();h()}catch(P){n.error(P)}}))};return e.subscribe(Y(n,y,function(){f=!0,h()})),function(){}}function Fe(e,n,t){return t===void 0&&(t=1/0),x(n)?Fe(function(r,i){return Tn(function(s,o){return n(r,s,i,o)})(U(e(r,i)))},t):(typeof n=="number"&&(t=n),Q(function(r,i){return zr(r,i,e,t)}))}function Vr(e){return e===void 0&&(e=1/0),Fe(lt,e)}var jr=["addListener","removeListener"],kr=["addEventListener","removeEventListener"],ei=["on","off"];function se(e,n,t,r){if(x(t)&&(r=t,t=void 0),r)return se(e,n,t).pipe(Zr(r));var i=Te(ri(e)?kr.map(function(l){return function(u){return e[l](n,u,t)}}):ni(e)?jr.map(ze(e,n)):ti(e)?ei.map(ze(e,n)):[],2),s=i[0],o=i[1];if(!s&&Ce(e))return Fe(function(l){return se(l,n,t)})(U(e));if(!s)throw new TypeError("Invalid event target");return new R(function(l){var u=function(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];return l.next(1<c.length?c:c[0])};return s(u),function(){return o(u)}})}function ze(e,n){return function(t){return function(r){return e[t](n,r)}}}function ni(e){return x(e.addListener)&&x(e.removeListener)}function ti(e){return x(e.on)&&x(e.off)}function ri(e){return x(e.addEventListener)&&x(e.removeEventListener)}function ii(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t=Rr(e),r=Lr(e,1/0),i=e;return i.length?i.length===1?U(i[0]):Vr(r)(Yr(i,t)):Ir}function Rn(e,n){return Q(function(t,r){var i=0;t.subscribe(Y(r,function(s){return e.call(n,s,i++)&&r.next(s)}))})}function Ve(e,n){return n===void 0&&(n=Or),Q(function(t,r){var i=null,s=null,o=null,l=function(){if(i){i.unsubscribe(),i=null;var c=s;s=null,r.next(c)}};function u(){var c=o+e,d=n.now();if(d<c){i=this.schedule(void 0,c-d),r.add(i);return}l()}t.subscribe(Y(r,function(c){s=c,o=n.now(),i||(i=n.schedule(u,e),r.add(i))},function(){l(),r.complete()},void 0,function(){s=i=null}))})}var N,E,B,M,H;class si{constructor(){p(this,N,new fe("Editor"));p(this,E,void 0);v(this,"contentChange$",new un);v(this,"id",Er());p(this,B,void 0);p(this,M,document.createElement("div"));p(this,H,void 0);v(this,"render",n=>{n.append(a(this,M)),C(this,H,n),a(this,B)&&this.renderPath(a(this,B))});a(this,M).style.height="100%",C(this,E,He.create(a(this,M),yr({fontSize:14,automaticLayout:!0,minimap:{enabled:!1}}))),a(this,E).onDidChangeModelContent(()=>{var n;this.contentChange$.next([(n=a(this,E).getModel())==null?void 0:n.uri.fsPath,a(this,E).getValue()])})}renderPath(n){const t=He.getModel(ct.parse(n));a(this,N).log("render path",n),a(this,N).log("model",t),t&&a(this,E).getModel()!==t&&(a(this,N).log("set model",t),a(this,E).setModel(t)),C(this,B,n)}remove(){a(this,M).remove()}dispose(){var n;(n=a(this,E))==null||n.dispose()}layout(){a(this,E).layout(),a(this,H)&&(a(this,M).remove(),requestIdleCallback(()=>{this.render(a(this,H))},{timeout:1e3}))}getValue(){return a(this,E).getValue()??""}setValue(n){a(this,E).getValue()!==n&&a(this,E).setValue(n)}}N=new WeakMap,E=new WeakMap,B=new WeakMap,M=new WeakMap,H=new WeakMap;function ai(e,n="",t=document.body){const r=document.createElement("script");return n&&r.setAttribute("type",n),r.innerHTML=e,t.append(r),r}function oi(e,n="",t=document.body){const r=document.createElement("script");return n&&r.setAttribute("type",n),r.src=e,t.append(r),r}function ui(e,n=document.body){const t=document.createElement("style");return t.type="text/css",t.innerHTML=e,n.append(t),t}function ge(e){const n=document.createElement("div");return n.innerHTML=e,n.childNodes[0]}const li=["log","error"];function ci(){const e=Object.create(window.console);return li.reduce((n,t)=>(Xe(n,`${t}$`,new Z),Xe(n,t,(...r)=>{n[`${t}$`].next(r),window.console[t](...r)}),n),e),e}var Se=(e=>(e[e.Loading=0]="Loading",e[e.Loaded=1]="Loaded",e))(Se||{}),L,S,z,D,I,V,ae;class Ln{constructor(){v(this,"EState",Se);v(this,"console",ci());v(this,"state$",new Z);v(this,"error$",new Z);v(this,"load$");v(this,"fullscreenChange$");p(this,L,ge('<iframe style="border: none; width: 100%; height: 100%"></iframe>'));p(this,S,null);p(this,z,new fe("previewer"));p(this,D,{scripts:[],styles:[],globals:{},html:'<div id="root"></div>'});p(this,I,{scripts:new Map,styles:new Map,globals:{},html:ge("<div id='root'></div>")});p(this,V,new de);p(this,ae,()=>{if(!a(this,S))return;a(this,z).log("loadSources",{sources:a(this,D)}),a(this,S).console=this.console,a(this,S).addEventListener("error",u=>{this.error$.next(u.message)}),a(this,S).addEventListener("unhandledrejection",u=>{this.error$.next(`Unhandledrejection:
${u.reason}`)});const n=a(this,S).document.head,t=document.createElement("style");t.textContent="body { background-color: white; }",n.append(t);const r=a(this,S).document.body,{globals:i,scripts:s,styles:o,html:l}=a(this,D);if(a(this,z).log({globals:i}),a(this,I).html.remove(),l){const u=ge(l);r.append(u),a(this,I).html=u}Object.keys(a(this,I).globals).forEach(u=>{delete a(this,S)[u]}),Object.entries(i).forEach(([u,c])=>{a(this,S)[u]=c}),a(this,I).globals=i,o.forEach(u=>{const{id:c,content:d}=u;let f=a(this,I).styles.get(c);f&&f.remove(),f=ui(d,r),f.setAttribute("data-style-id",c),a(this,I).styles.set(c,f)}),s.forEach(u=>{const{id:c,content:d,type:f,src:h}=u;let y=a(this,I).scripts.get(c);if(y&&y.remove(),h)y=oi(h,f,r);else if(d)y=ai(d,f,r);else throw new Error("script must have src or content");y.setAttribute("data-script-id",c),a(this,I).scripts.set(c,y)})});v(this,"updateSources",n=>{C(this,D,{...a(this,D),...n}),this.reload()});v(this,"render",n=>{n.append(a(this,L))});v(this,"dispose",()=>{a(this,V).unsubscribe(),a(this,L).remove()});v(this,"requestFullscreen",()=>{var n;if(a(this,L).isConnected)return(n=a(this,L).contentWindow)==null?void 0:n.document.documentElement.requestFullscreen()});this.state$.next(0),this.load$=se(a(this,L),"load"),a(this,V).add(this.load$.subscribe(()=>{this.state$.next(1),C(this,S,a(this,L).contentWindow),a(this,ae).call(this)})),this.fullscreenChange$=se(a(this,L),"fullscreenchange")}reload(){var n;this.state$.next(0),(n=a(this,S))==null||n.location.reload()}}L=new WeakMap,S=new WeakMap,z=new WeakMap,D=new WeakMap,I=new WeakMap,V=new WeakMap,ae=new WeakMap,v(Ln,"EState",Se);var T,oe,j;class di{constructor(n){v(this,"change$",new Z);v(this,"newFile$",new un);p(this,T,new dt);p(this,oe,new de);p(this,j,void 0);this.cwd=n,C(this,j,new fe(`explore-${n}`)),a(this,oe).add(g.newFile$.pipe(Rn(t=>ln(t,this.cwd))).subscribe(t=>{a(this,j).log(`new file ${t}`),this.newFile$.next(t)}))}renameSync(n,t){const r=()=>{this.change$.next(),g.fs.renameSync(this.resolve(t),this.resolve(n))},i=()=>{this.change$.next(),g.fs.renameSync(this.resolve(n),this.resolve(t))};a(this,T).add({undo:r,redo:i}),i()}unlinkSync(n){const t=()=>{this.change$.next(),g.fs.unlinkSync(O(this.cwd,n))},r=g.fs.readFileSync(this.resolve(n)),i=()=>{this.change$.next(),g.fs.writeFileSync(this.resolve(n),r)};a(this,T).add({undo:i,redo:t}),t()}rmdirSync(n){const t=()=>{this.change$.next(),g.fs.rmdirSync(O(this.cwd,n))},r=g.fs.getFilesByPattern([G(O(this.cwd,n),"**/*")],{onlyFiles:!0}),i=()=>{this.change$.next(),Object.entries(r).forEach(([s,o])=>{g.fs.writeFileSync(s,o)})};a(this,T).add({undo:i,redo:t}),t()}mkdirSync(n){const t=()=>{this.change$.next(),g.fs.mkdirSync(O(this.cwd,n))},r=()=>{this.change$.next(),g.fs.rmdirSync(O(this.cwd,n))};a(this,T).add({undo:r,redo:t}),t()}writeFileSync(n,t){this.change$.next(),g.fs.writeFileSync(O(this.cwd,n),t)}readFileSync(n,t){return g.fs.readFileSync(O(this.cwd,n),t)}isDirectory(n){return g.fs.existsSync(O(this.cwd,n))&&g.fs.statSync(O(this.cwd,n)).isDirectory()}resolve(n){return O(this.cwd,n)}relative(n){return cn(this.cwd,n)}existsSync(n){return g.fs.existsSync(O(this.cwd,n))}undo(){a(this,T).undo()}redo(){a(this,T).redo()}hasUndo(){return a(this,T).hasUndo()}hasRedo(){return a(this,T).hasRedo()}}T=new WeakMap,oe=new WeakMap,j=new WeakMap;var Cn=(e=>(e[e.Start=0]="Start",e[e.LoadingEsbuildWasm=1]="LoadingEsbuildWasm",e[e.Building=2]="Building",e[e.Error=3]="Error",e[e.Done=4]="Done",e))(Cn||{}),K,A,F,m,ue,Fn;const le=class le{constructor(n){p(this,ue);v(this,"EBuildState",Cn);v(this,"id");v(this,"cwd");v(this,"editor",new si);v(this,"previewer",new Ln);v(this,"explore");v(this,"loading$",new re(!0));v(this,"fs$");v(this,"debouncedFs$");v(this,"buildState$",new re(0));v(this,"selectedPath$",new re(""));v(this,"buildResult$",new re(void 0));p(this,A,void 0);p(this,F,new de);p(this,m,void 0);const t={buildInputPattern:[G(n.cwd,"**/*"),G(n.cwd,"*"),"/node_modules/**/*.js"],buildOptions:{},globalExternals:{},directoryTreePathsPattern:[G(n.cwd,"**/*"),G(n.cwd,"*")]};C(this,m,{...t,...xr(n,vr),entry:n.entry?ft(n.entry)?n.entry:G(n.cwd,n.entry):""}),this.explore=new di(a(this,m).cwd),this.id=a(this,m).cwd,this.cwd=a(this,m).cwd,C(this,A,new fe(`playground-${this.id}`)),this.fs$=ii(this.explore.newFile$,this.explore.change$),this.debouncedFs$=this.fs$.pipe(Ve(200)),this.debouncedFs$.subscribe(()=>this.loading$.next(!1)),a(this,F).add(this.editor.contentChange$.pipe(Ve(500)).subscribe(([r,i])=>{!r||!ln(r,a(this,m).cwd)||this.explore.writeFileSync(r,i)})),a(this,F).add(this.explore.newFile$.pipe(Rn(r=>r===a(this,m).entry)).subscribe(()=>{this.editor.renderPath(a(this,m).entry)})),a(this,F).add(this.selectedPath$.subscribe(r=>{a(this,A).log("selectedPath$",r),this.editor.renderPath(this.explore.resolve(r))})),a(this,F).add(this.debouncedFs$.subscribe(()=>this.build())),a(this,F).add(this.explore.newFile$.subscribe(r=>{a(this,m).entry||["index.ts","index.tsx","src/index.ts","src/index.tsx"].map(i=>this.explore.resolve(i)).includes(this.explore.resolve(r))&&(a(this,m).entry=this.explore.resolve(r)),!this.selectedPath$.value&&a(this,m).entry!==""&&this.explore.resolve(r)===a(this,m).entry&&(a(this,A).log("auto select entry",this.getEntryPathRelativeCwd()),this.selectedPath$.next(this.getEntryPathRelativeCwd()))}))}static create(n){if(a(this,K).has(n.cwd))return a(this,K).get(n.cwd);const t=new le(n);return a(this,K).set(n.cwd,t),t}getDirectoryTreePaths(){return g.fs.globSync(a(this,m).directoryTreePathsPattern,{onlyFiles:!1}).map(t=>cn(a(this,m).cwd,t))}async build(){a(this,A).timeAsyncFn(()=>qe(this,ue,Fn).call(this),"build")}destroy(){a(this,F).unsubscribe(),this.editor.dispose(),this.previewer.dispose()}getEntryPathRelativeCwd(){return this.explore.relative(a(this,m).entry)}async download(){const n=new ht;return this.getDirectoryTreePaths().forEach(r=>{this.explore.isDirectory(r)||n.file(r,this.explore.readFileSync(r,"utf-8"))}),n.generateAsync({type:"blob"}).then(r=>{vt.saveAs(r,"playground.zip")})}};K=new WeakMap,A=new WeakMap,F=new WeakMap,m=new WeakMap,ue=new WeakSet,Fn=async function(){this.buildState$.next(1),a(this,A).log("loading esbuild.wasm..."),await Ke.load(),this.buildState$.next(2),a(this,A).log("building...");const{globalExternals:n={},buildInputPattern:t,buildOptions:r}=a(this,m),i=Object.entries(g.fs.getFilesByPattern(t)).reduce((s,[o,l])=>(s[this.explore.relative(o)]=l,s),{});if(!g.fs.existsSync(a(this,m).entry)){this.buildState$.next(3),this.buildResult$.next({buildError:new Error(`Entry file "${this.getEntryPathRelativeCwd()}" not found`),css:"",errors:[],hash:"",js:""}),a(this,A).log("build error");return}if(!g.fs.statSync(a(this,m).entry).isFile()){this.buildState$.next(3),this.buildResult$.next({buildError:new Error(`Entry file "${this.getEntryPathRelativeCwd()}" is not a file`),css:"",errors:[],hash:"",js:""}),a(this,A).log("build error");return}return Ke.build({input:i,entry:this.getEntryPathRelativeCwd(),globalExternals:n,...r}).then(s=>{var d,f,h;if(s.errors.length>0||s.buildError){this.buildState$.next(3),this.buildResult$.next(s),a(this,A).log("build error");return}if(a(this,A).log("build success"),this.buildState$.next(4),((d=this.buildResult$.getValue())==null?void 0:d.hash)===s.hash){a(this,A).log("hash equals");return}this.buildResult$.next(s);const{css:l,js:u,globalExternals:c}=s;this.previewer.updateSources({scripts:[{id:"externals",content:`var module = {exports: { default: {} }};
          function require (name) {
            var value = module.exports[name] || (module.exports.default ? module.exports.default[name] : null);
            if (value) {
              value.__esModule = true;
              return value;
            }
          
            throw new Error("module not found: " + name);
          }
          
          ${((f=g.template.externals)==null?void 0:f.cjsCode)??""}
            `},{id:"build",content:u??""}],styles:[{id:"externals",content:((h=g.template.externals)==null?void 0:h.cssCode)??""},{id:"build",content:l??""}],globals:c})})},p(le,K,new Map);let $e=le;const Me=e=>pe.createElement(Re.Provider,{value:e.value},e.children);Me.Consumer=Re.Consumer;const Mn=pe.memo(e=>{const{entry:n,globalExternals:t,buildInputPattern:r,directoryTreePathsPattern:i,cwd:s,buildOptions:o,children:l}=e,u=je.useMemo(()=>$e.create({cwd:s,entry:n,globalExternals:t,buildInputPattern:r,buildOptions:o,directoryTreePathsPattern:i}),[r,t,n,o,i,s]);return pe.createElement(Me,{value:u,children:l})},(e,n)=>{const t=["globalExternals","buildOptions","children"];return Object.keys(e).every(r=>t.includes(r)?e[r]===n[r]:JSON.stringify(e[r])===JSON.stringify(n[r]))}),yi=Object.assign(Mn,{Consumer:Re.Consumer});Me.__docgenInfo={description:"",methods:[],displayName:"PlaygroundProvider",props:{value:{required:!0,tsType:{name:"Playground"},description:""}}};Mn.__docgenInfo={description:"",methods:[],displayName:"_PlaygroundProviderBuilder",props:{globalExternals:{required:!1,tsType:{name:"Record",elements:[{name:"string"},{name:"any"}],raw:"Record<string, any>"},description:""},entry:{required:!1,tsType:{name:"string"},description:'The entry file to be built and auto selected, can be absolute path or relative path, if not set, it will be auto resolved from cwd in these files: ["./index.ts", "./index.tsx", "./src/index.ts", "./src.index.tsx"]'},buildInputPattern:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:`The input of esbuild, can be glob pattern
@default  [
        join(options.cwd, "**\\/*"),
        join(options.cwd, "\\/*"),
        "/node_modules\\/**\\/*.js",
      ]`},buildOptions:{required:!1,tsType:{name:"Omit",elements:[{name:"IBuildOptions"},{name:"union",raw:'"entry" | "input" | "globalExternals"',elements:[{name:"literal",value:'"entry"'},{name:"literal",value:'"input"'},{name:"literal",value:'"globalExternals"'}]}],raw:'Omit<IBuildOptions, "entry" | "input" | "globalExternals">'},description:"@default {}"},directoryTreePathsPattern:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:`@default  [
        join(options.cwd, "**\\/*"),
        join(options.cwd, "\\/*"),
      ]`},cwd:{required:!0,tsType:{name:"string"},description:'@default "/"'},children:{required:!1,tsType:{name:"ReactNode"},description:""}}};export{li as C,yi as P,Re as a,Rn as b,$e as c,Ve as d,Me as e,se as f,Tn as g,gt as i,ii as m};
