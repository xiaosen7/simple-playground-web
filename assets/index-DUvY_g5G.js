var lt=Object.defineProperty;var ct=(e,t,n)=>t in e?lt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var h=(e,t,n)=>(ct(e,typeof t!="symbol"?t+"":t,n),n),ge=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)};var o=(e,t,n)=>(ge(e,t,"read from private field"),n?n.call(e):t.get(e)),m=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},M=(e,t,n,r)=>(ge(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n);import{r as de,R as se}from"./index-CBqU2yxZ.js";import{e as fe,M as dt,S as pe,f as ft,U as we,g as me,h as xe,k as be,l as W,n as ht,o as Z,q as Ae,i as ae,s as vt,u as he,v as ee,w as yt,x as Ce,y as gt,z as Me,A as pt,B as wt,C as mt,D as xt,E as bt,F as I,G as H,H as At,I as z,J as Fe,K as Et,_ as Pt,L as St,N as _t,O as T,P as De,Q as Ot,R as Ue,T as te,V as $t,W as It,X as Tt,Y as Rt,Z as Lt,$ as qe,a0 as X,a1 as Ee,a2 as Ct,a3 as Mt,p as g,j as Q,a4 as L,a5 as Ne,a6 as Ft,a7 as Pe,a as Se}from"./undomanager-CFNGFqu4.js";const Ge=de.createContext(null);function xr(){const e=de.useContext(Ge);if(!e)throw new Error("usePlayground must be used within a PlaygroundProvider");return e}function Dt(e,t,n){var r=e==null?void 0:fe(e,t);return r===void 0?n:r}var Ut="__lodash_hash_undefined__";function qt(e){return this.__data__.set(e,Ut),this}function Nt(e){return this.__data__.has(e)}function V(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new dt;++t<n;)this.add(e[t])}V.prototype.add=V.prototype.push=qt;V.prototype.has=Nt;function Gt(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function Bt(e,t){return e.has(t)}var Ht=1,Kt=2;function Be(e,t,n,r,i,s){var a=n&Ht,u=e.length,l=t.length;if(u!=l&&!(a&&l>u))return!1;var c=s.get(e),d=s.get(t);if(c&&d)return c==t&&d==e;var f=-1,v=!0,A=n&Kt?new V:void 0;for(s.set(e,t),s.set(t,e);++f<u;){var w=e[f],p=t[f];if(r)var P=a?r(p,w,f,t,e,s):r(w,p,f,e,t,s);if(P!==void 0){if(P)continue;v=!1;break}if(A){if(!Gt(t,function(x,E){if(!Bt(A,E)&&(w===x||i(w,x,n,r,s)))return A.push(E)})){v=!1;break}}else if(!(w===p||i(w,p,n,r,s))){v=!1;break}}return s.delete(e),s.delete(t),v}function Yt(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function Jt(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var Wt=1,Xt=2,Qt="[object Boolean]",Zt="[object Date]",zt="[object Error]",Vt="[object Map]",jt="[object Number]",kt="[object RegExp]",en="[object Set]",tn="[object String]",nn="[object Symbol]",rn="[object ArrayBuffer]",sn="[object DataView]",_e=pe?pe.prototype:void 0,ne=_e?_e.valueOf:void 0;function an(e,t,n,r,i,s,a){switch(n){case sn:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case rn:return!(e.byteLength!=t.byteLength||!s(new we(e),new we(t)));case Qt:case Zt:case jt:return ft(+e,+t);case zt:return e.name==t.name&&e.message==t.message;case kt:case tn:return e==t+"";case Vt:var u=Yt;case en:var l=r&Wt;if(u||(u=Jt),e.size!=t.size&&!l)return!1;var c=a.get(e);if(c)return c==t;r|=Xt,a.set(e,t);var d=Be(u(e),u(t),r,i,s,a);return a.delete(e),d;case nn:if(ne)return ne.call(e)==ne.call(t)}return!1}var on=1,un=Object.prototype,ln=un.hasOwnProperty;function cn(e,t,n,r,i,s){var a=n&on,u=me(e),l=u.length,c=me(t),d=c.length;if(l!=d&&!a)return!1;for(var f=l;f--;){var v=u[f];if(!(a?v in t:ln.call(t,v)))return!1}var A=s.get(e),w=s.get(t);if(A&&w)return A==t&&w==e;var p=!0;s.set(e,t),s.set(t,e);for(var P=a;++f<l;){v=u[f];var x=e[v],E=t[v];if(r)var ye=a?r(E,x,v,t,e,s):r(x,E,v,e,t,s);if(!(ye===void 0?x===E||i(x,E,n,r,s):ye)){p=!1;break}P||(P=v=="constructor")}if(p&&!P){var K=e.constructor,Y=t.constructor;K!=Y&&"constructor"in e&&"constructor"in t&&!(typeof K=="function"&&K instanceof K&&typeof Y=="function"&&Y instanceof Y)&&(p=!1)}return s.delete(e),s.delete(t),p}var dn=1,Oe="[object Arguments]",$e="[object Array]",J="[object Object]",fn=Object.prototype,Ie=fn.hasOwnProperty;function hn(e,t,n,r,i,s){var a=Z(e),u=Z(t),l=a?$e:xe(e),c=u?$e:xe(t);l=l==Oe?J:l,c=c==Oe?J:c;var d=l==J,f=c==J,v=l==c;if(v&&be(e)){if(!be(t))return!1;a=!0,d=!1}if(v&&!d)return s||(s=new W),a||ht(e)?Be(e,t,n,r,i,s):an(e,t,l,n,r,i,s);if(!(n&dn)){var A=d&&Ie.call(e,"__wrapped__"),w=f&&Ie.call(t,"__wrapped__");if(A||w){var p=A?e.value():e,P=w?t.value():t;return s||(s=new W),i(p,P,n,r,s)}}return v?(s||(s=new W),cn(e,t,n,r,i,s)):!1}function ve(e,t,n,r,i){return e===t?!0:e==null||t==null||!Ae(e)&&!Ae(t)?e!==e&&t!==t:hn(e,t,n,r,ve,i)}var vn=1,yn=2;function gn(e,t,n,r){var i=n.length,s=i,a=!r;if(e==null)return!s;for(e=Object(e);i--;){var u=n[i];if(a&&u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++i<s;){u=n[i];var l=u[0],c=e[l],d=u[1];if(a&&u[2]){if(c===void 0&&!(l in e))return!1}else{var f=new W;if(r)var v=r(c,d,l,e,t,f);if(!(v===void 0?ve(d,c,vn|yn,r,f):v))return!1}}return!0}function He(e){return e===e&&!ae(e)}function pn(e){for(var t=vt(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,He(i)]}return t}function Ke(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function wn(e){var t=pn(e);return t.length==1&&t[0][2]?Ke(t[0][0],t[0][1]):function(n){return n===e||gn(n,e,t)}}function mn(e,t){return e!=null&&t in Object(e)}function xn(e,t,n){t=he(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var a=ee(t[r]);if(!(s=e!=null&&n(e,a)))break;e=e[a]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&yt(i)&&Ce(a,i)&&(Z(e)||gt(e)))}function bn(e,t){return e!=null&&xn(e,t,mn)}var An=1,En=2;function Pn(e,t){return Me(e)&&He(t)?Ke(ee(e),t):function(n){var r=Dt(n,e);return r===void 0&&r===t?bn(n,e):ve(t,r,An|En)}}function Sn(e){return function(t){return t==null?void 0:t[e]}}function _n(e){return function(t){return fe(t,e)}}function On(e){return Me(e)?Sn(ee(e)):_n(e)}function Ye(e){return typeof e=="function"?e:e==null?pt:typeof e=="object"?Z(e)?Pn(e[0],e[1]):wn(e):On(e)}function $n(e){return e==null}var In="Expected a function";function Tn(e){if(typeof e!="function")throw new TypeError(In);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function Rn(e,t,n,r){if(!ae(e))return e;t=he(t,e);for(var i=-1,s=t.length,a=s-1,u=e;u!=null&&++i<s;){var l=ee(t[i]),c=n;if(l==="__proto__"||l==="constructor"||l==="prototype")return e;if(i!=a){var d=u[l];c=r?r(d,l,u):void 0,c===void 0&&(c=ae(d)?d:Ce(t[i+1])?[]:{})}wt(u,l,c),u=u[l]}return e}function Ln(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var a=t[r],u=fe(e,a);n(u,a)&&Rn(s,he(a,e),u)}return s}function Cn(e,t){if(e==null)return{};var n=mt(xt(e),function(r){return[r]});return t=Ye(t),Ln(e,n,function(r,i){return t(r,i[0])})}function Mn(e,t){return Cn(e,Tn(Ye(t)))}var Fn=0;function Dn(e){var t=++Fn;return bt(e)+t}function Un(e){return I(e==null?void 0:e.lift)}function G(e){return function(t){if(Un(t))return t.lift(function(n){try{return e(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function N(e,t,n,r,i){return new qn(e,t,n,r,i)}var qn=function(e){H(t,e);function t(n,r,i,s,a,u){var l=e.call(this,n)||this;return l.onFinalize=a,l.shouldUnsubscribe=u,l._next=r?function(c){try{r(c)}catch(d){n.error(d)}}:e.prototype._next,l._error=s?function(c){try{s(c)}catch(d){n.error(d)}finally{this.unsubscribe()}}:e.prototype._error,l._complete=i?function(){try{i()}catch(c){n.error(c)}finally{this.unsubscribe()}}:e.prototype._complete,l}return t.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},t}(At),Te=function(e){H(t,e);function t(n){var r=e.call(this)||this;return r._value=n,r}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(n){var r=e.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},t.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,s=n._value;if(r)throw i;return this._throwIfClosed(),s},t.prototype.next=function(n){e.prototype.next.call(this,this._value=n)},t}(z),Nn=function(e){H(t,e);function t(n,r){return e.call(this)||this}return t.prototype.schedule=function(n,r){return this},t}(Fe),oe={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,Et([e,t],Pt(n)))},clearInterval:function(e){var t=oe.delegate;return((t==null?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},Gn=function(e){H(t,e);function t(n,r){var i=e.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return t.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var s=this.id,a=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(a,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(a,this.id,r),this},t.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),oe.setInterval(n.flush.bind(n,this),i)},t.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&oe.clearInterval(r)},t.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(n,r){var i=!1,s;try{this.work(n)}catch(a){i=!0,s=a||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},t.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,St(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(Nn),Re=function(){function e(t,n){n===void 0&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(t,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,t).schedule(r,n)},e.now=_t.now,e}(),Bn=function(e){H(t,e);function t(n,r){r===void 0&&(r=Re.now);var i=e.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return t.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},t}(Re),Hn=new Bn(Gn),Kn=new T(function(e){return e.complete()});function Yn(e){return e&&I(e.schedule)}function Je(e){return e[e.length-1]}function Jn(e){return Yn(Je(e))?e.pop():void 0}function Wn(e,t){return typeof Je(e)=="number"?e.pop():t}var We=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function Xe(e){return I(e==null?void 0:e.then)}function Qe(e){return I(e[De])}function Ze(e){return Symbol.asyncIterator&&I(e==null?void 0:e[Symbol.asyncIterator])}function ze(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Xn(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Ve=Xn();function je(e){return I(e==null?void 0:e[Ve])}function ke(e){return Ot(this,arguments,function(){var n,r,i,s;return Ue(this,function(a){switch(a.label){case 0:n=e.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,te(n.read())];case 3:return r=a.sent(),i=r.value,s=r.done,s?[4,te(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,te(i)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function et(e){return I(e==null?void 0:e.getReader)}function B(e){if(e instanceof T)return e;if(e!=null){if(Qe(e))return Qn(e);if(We(e))return Zn(e);if(Xe(e))return zn(e);if(Ze(e))return tt(e);if(je(e))return Vn(e);if(et(e))return jn(e)}throw ze(e)}function Qn(e){return new T(function(t){var n=e[De]();if(I(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Zn(e){return new T(function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}function zn(e){return new T(function(t){e.then(function(n){t.closed||(t.next(n),t.complete())},function(n){return t.error(n)}).then(null,$t)})}function Vn(e){return new T(function(t){var n,r;try{for(var i=It(e),s=i.next();!s.done;s=i.next()){var a=s.value;if(t.next(a),t.closed)return}}catch(u){n={error:u}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}t.complete()})}function tt(e){return new T(function(t){kn(e,t).catch(function(n){return t.error(n)})})}function jn(e){return tt(ke(e))}function kn(e,t){var n,r,i,s;return Tt(this,void 0,void 0,function(){var a,u;return Ue(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=Rt(e),l.label=1;case 1:return[4,n.next()];case 2:if(r=l.sent(),!!r.done)return[3,4];if(a=r.value,t.next(a),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return u=l.sent(),i={error:u},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function C(e,t,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(s),!i)return s}function nt(e,t){return t===void 0&&(t=0),G(function(n,r){n.subscribe(N(r,function(i){return C(r,e,function(){return r.next(i)},t)},function(){return C(r,e,function(){return r.complete()},t)},function(i){return C(r,e,function(){return r.error(i)},t)}))})}function rt(e,t){return t===void 0&&(t=0),G(function(n,r){r.add(e.schedule(function(){return n.subscribe(r)},t))})}function er(e,t){return B(e).pipe(rt(t),nt(t))}function tr(e,t){return B(e).pipe(rt(t),nt(t))}function nr(e,t){return new T(function(n){var r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}function rr(e,t){return new T(function(n){var r;return C(n,t,function(){r=e[Ve](),C(n,t,function(){var i,s,a;try{i=r.next(),s=i.value,a=i.done}catch(u){n.error(u);return}a?n.complete():n.next(s)},0,!0)}),function(){return I(r==null?void 0:r.return)&&r.return()}})}function it(e,t){if(!e)throw new Error("Iterable cannot be null");return new T(function(n){C(n,t,function(){var r=e[Symbol.asyncIterator]();C(n,t,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function ir(e,t){return it(ke(e),t)}function sr(e,t){if(e!=null){if(Qe(e))return er(e,t);if(We(e))return nr(e,t);if(Xe(e))return tr(e,t);if(Ze(e))return it(e,t);if(je(e))return rr(e,t);if(et(e))return ir(e,t)}throw ze(e)}function ar(e,t){return t?sr(e,t):B(e)}function or(e,t){return G(function(n,r){var i=0;n.subscribe(N(r,function(s){r.next(e.call(t,s,i++))}))})}function ur(e,t,n,r,i,s,a,u){var l=[],c=0,d=0,f=!1,v=function(){f&&!l.length&&!c&&t.complete()},A=function(p){return c<r?w(p):l.push(p)},w=function(p){s&&t.next(p),c++;var P=!1;B(n(p,d++)).subscribe(N(t,function(x){i==null||i(x),s?A(x):t.next(x)},function(){P=!0},void 0,function(){if(P)try{c--;for(var x=function(){var E=l.shift();a?C(t,a,function(){return w(E)}):w(E)};l.length&&c<r;)x();v()}catch(E){t.error(E)}}))};return e.subscribe(N(t,A,function(){f=!0,v()})),function(){u==null||u()}}function st(e,t,n){return n===void 0&&(n=1/0),I(t)?st(function(r,i){return or(function(s,a){return t(r,s,i,a)})(B(e(r,i)))},n):(typeof t=="number"&&(n=t),G(function(r,i){return ur(r,i,e,n)}))}function lr(e){return e===void 0&&(e=1/0),st(Lt,e)}function cr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Jn(e),r=Wn(e,1/0),i=e;return i.length?i.length===1?B(i[0]):lr(r)(ar(i,n)):Kn}function Le(e,t){return G(function(n,r){var i=0;n.subscribe(N(r,function(s){return e.call(t,s,i++)&&r.next(s)}))})}function re(e,t){return t===void 0&&(t=Hn),G(function(n,r){var i=null,s=null,a=null,u=function(){if(i){i.unsubscribe(),i=null;var c=s;s=null,r.next(c)}};function l(){var c=a+e,d=t.now();if(d<c){i=this.schedule(void 0,c-d),r.add(i);return}u()}n.subscribe(N(r,function(c){s=c,a=t.now(),i||(i=t.schedule(l,e),r.add(i))},function(){u(),r.complete()},void 0,function(){s=i=null}))})}var ce,b,D;class dr{constructor(){m(this,ce,new qe("Editor"));m(this,b,void 0);h(this,"contentChange$",new X);h(this,"id",Dn());m(this,D,void 0);h(this,"render",t=>{o(this,b)&&o(this,b).dispose();const n=Ee.create(t,{fontSize:14,automaticLayout:!0,minimap:{enabled:!1}});n.onDidChangeModelContent(()=>{var r;this.contentChange$.next([(r=n.getModel())==null?void 0:r.uri.fsPath,n.getValue()])}),M(this,b,n),o(this,D)&&this.renderPath(o(this,D))})}renderPath(t){var r,i;const n=Ee.getModel(Ct.parse(t));n&&((r=o(this,b))==null?void 0:r.getModel())!==n&&((i=o(this,b))==null||i.setModel(n)),M(this,D,t)}dispose(){var t;(t=o(this,b))==null||t.dispose()}layout(){var t;(t=o(this,b))==null||t.layout()}getValue(){var t;return((t=o(this,b))==null?void 0:t.getValue())??""}setValue(t){var n,r;((n=o(this,b))==null?void 0:n.getValue())!==t&&((r=o(this,b))==null||r.setValue(t))}}ce=new WeakMap,b=new WeakMap,D=new WeakMap;function fr(e,t="",n=document.body){const r=document.createElement("script");return t&&r.setAttribute("type",t),r.innerHTML=e,n.append(r),r}function hr(e,t="",n=document.body){const r=document.createElement("script");return t&&r.setAttribute("type",t),r.src=e,n.append(r),r}function vr(e,t=document.body){const n=document.createElement("style");return n.type="text/css",n.innerHTML=e,t.append(n),n}function ie(e){const t=document.createElement("div");return t.innerHTML=e,t.childNodes[0]}var ue=(e=>(e[e.Loading=0]="Loading",e[e.Loaded=1]="Loaded",e))(ue||{}),U,S,R,_,j;class at{constructor(){h(this,"EState",ue);m(this,U,{scripts:[],styles:[],globals:{},html:'<div id="root"></div>'});m(this,S,{scripts:new Map,styles:new Map,globals:{},html:ie("<div id='root'></div>")});h(this,"state$",new z);h(this,"error$",new z);m(this,R,ie('<iframe style="border: none; width: 100%; height: 100%"></iframe>'));m(this,_,null);m(this,j,()=>{if(!o(this,_))return;o(this,_).addEventListener("error",a=>{this.error$.next(a.message)}),o(this,_).addEventListener("unhandledrejection",a=>{this.error$.next(`Unhandledrejection:
${a.reason}`)});const t=o(this,_).document.body;t.style.backgroundColor="white";const{globals:n,scripts:r,styles:i,html:s}=o(this,U);if(o(this,S).html.remove(),s){const a=ie(s);t.append(a),o(this,S).html=a}Object.keys(o(this,S).globals).forEach(a=>{delete o(this,_)[a]}),Object.entries(n).forEach(([a,u])=>{o(this,_)[a]=u}),o(this,S).globals=n,i.forEach(a=>{const{id:u,content:l}=a;let c=o(this,S).styles.get(u);c?c.textContent=l:(c=vr(a.content,t),c.setAttribute("data-style-id",u),o(this,S).styles.set(u,c))}),r.forEach(a=>{const{id:u,content:l,type:c,src:d}=a;let f=o(this,S).scripts.get(u);if(f&&f.remove(),d)f=hr(d,c,t);else if(l)f=fr(l,c,t);else throw new Error("script must have src or content");f.setAttribute("data-script-id",u),o(this,S).scripts.set(u,f)})});h(this,"updateSources",t=>{M(this,U,{...o(this,U),...t}),this.reload()});h(this,"render",t=>{t.append(o(this,R))});h(this,"dispose",()=>{o(this,R).remove()});h(this,"requestFullscreen",()=>{if(o(this,R).isConnected)return o(this,R).requestFullscreen()});this.state$.next(0),o(this,R).addEventListener("load",()=>{this.state$.next(1),M(this,_,o(this,R).contentWindow),o(this,j).call(this)})}reload(){var t;this.state$.next(0),(t=o(this,_))==null||t.location.reload()}}U=new WeakMap,S=new WeakMap,R=new WeakMap,_=new WeakMap,j=new WeakMap,h(at,"EState",ue);var O;class yr{constructor(t){h(this,"change$",new z);m(this,O,new Mt);this.cwd=t}renameSync(t,n){const r=()=>{this.change$.next(),g.fs.renameSync(this.resolve(n),this.resolve(t))},i=()=>{this.change$.next(),g.fs.renameSync(this.resolve(t),this.resolve(n))};o(this,O).add({undo:r,redo:i}),i()}unlinkSync(t){const n=()=>{this.change$.next(),g.fs.unlinkSync(L(this.cwd,t))},r=g.fs.readFileSync(this.resolve(t)),i=()=>{this.change$.next(),g.fs.writeFileSync(this.resolve(t),r)};o(this,O).add({undo:i,redo:n}),n()}rmdirSync(t){const n=()=>{this.change$.next(),g.fs.rmdirSync(L(this.cwd,t))},r=g.fs.getFilesByPattern([Q(L(this.cwd,t),"**/*")],{onlyFiles:!0}),i=()=>{this.change$.next(),Object.entries(r).forEach(([s,a])=>{g.fs.writeFileSync(s,a)})};o(this,O).add({undo:i,redo:n}),n()}mkdirSync(t){const n=()=>{this.change$.next(),g.fs.mkdirSync(L(this.cwd,t))},r=()=>{this.change$.next(),g.fs.rmdirSync(L(this.cwd,t))};o(this,O).add({undo:r,redo:n}),n()}writeFileSync(t,n){this.change$.next(),g.fs.writeFileSync(L(this.cwd,t),n)}isDirectory(t){return g.fs.statSync(L(this.cwd,t)).isDirectory()}resolve(t){return L(this.cwd,t)}relative(t){return Ne(this.cwd,t)}undo(){o(this,O).undo()}redo(){o(this,O).redo()}hasUndo(){return o(this,O).hasUndo()}hasRedo(){return o(this,O).hasRedo()}}O=new WeakMap;var ot=(e=>(e[e.Start=0]="Start",e[e.LoadingEsbuildWasm=1]="LoadingEsbuildWasm",e[e.Building=2]="Building",e[e.Error=3]="Error",e[e.Done=4]="Done",e))(ot||{}),q,F,$,y;const k=class k{constructor(t){h(this,"EBuildState",ot);h(this,"id");h(this,"cwd");h(this,"editor",new dr);h(this,"previewer",new at);h(this,"explore");h(this,"directoryTreePaths$",new X);h(this,"buildState$",new Te(0));h(this,"selectedPath$",new X);h(this,"buildResult$",new Te(void 0));h(this,"newFile$",new X);m(this,F,void 0);m(this,$,new Fe);m(this,y,void 0);const n={buildInputPattern:[Q(t.cwd,"**/*"),"/node_modules/**/*.js"],buildOptions:{},globalExternals:{},directoryTreePathsPattern:[Q(t.cwd,"**/*")]};M(this,y,{...n,...Mn(t,$n),entry:t.entry?Ft(t.entry)?t.entry:Q(t.cwd,t.entry):""}),this.id=o(this,y).cwd,this.cwd=o(this,y).cwd,this.explore=new yr(o(this,y).cwd),M(this,F,new qe(this.id));const r=cr(this.newFile$,this.explore.change$);o(this,$).add(this.editor.contentChange$.pipe(re(500)).subscribe(([i,s])=>{!i||!Pe(i,o(this,y).cwd)||(g.fs.writeFileSync(i,s),this.build())})),o(this,$).add(this.newFile$.pipe(Le(i=>i===o(this,y).entry)).subscribe(()=>{this.editor.renderPath(o(this,y).entry)})),o(this,$).add(this.selectedPath$.subscribe(i=>{o(this,F).log("selectedPath$",i,g.fs.data),this.editor.renderPath(this.explore.resolve(i))})),o(this,$).add(r.pipe(re(200)).subscribe(()=>this.build())),o(this,$).add(r.pipe(re(200)).subscribe(()=>{const i=g.fs.globSync(o(this,y).directoryTreePathsPattern,{onlyFiles:!1}).map(s=>Ne(o(this,y).cwd,s));o(this,F).log("directoryTreePaths$",i),this.directoryTreePaths$.next(i)})),o(this,$).add(g.newFile$.pipe(Le(i=>Pe(i,o(this,y).cwd))).subscribe(i=>{o(this,F).log(`new file ${i}`),this.newFile$.next(i)})),o(this,$).add(this.newFile$.subscribe(i=>{o(this,y).entry||["index.ts","index.tsx","src/index.ts","src/index.tsx"].map(s=>this.explore.resolve(s)).includes(this.explore.resolve(i))&&(o(this,y).entry=this.explore.resolve(i)),o(this,y).entry!==""&&this.explore.resolve(i)===o(this,y).entry&&this.selectedPath$.next(this.getEntryPathRelativeCwd())}))}static create(t){if(o(this,q).has(t.cwd))return o(this,q).get(t.cwd);const n=new k(t);return o(this,q).set(t.cwd,n),n}async build(){this.buildState$.next(1),await Se.load(),this.buildState$.next(2);const{globalExternals:t={},buildInputPattern:n,buildOptions:r}=o(this,y),i=Object.entries(g.fs.getFilesByPattern(n)).reduce((s,[a,u])=>(s[this.explore.relative(a)]=u,s),{});if(!g.fs.existsSync(o(this,y).entry)){this.buildState$.next(3),this.buildResult$.next({buildError:new Error(`Entry file "${this.getEntryPathRelativeCwd()}" not found`),css:"",errors:[],hash:"",js:""});return}if(!g.fs.statSync(o(this,y).entry).isFile()){this.buildState$.next(3),this.buildResult$.next({buildError:new Error(`Entry file "${this.getEntryPathRelativeCwd()}" is not a file`),css:"",errors:[],hash:"",js:""});return}return Se.build({input:i,entry:this.getEntryPathRelativeCwd(),globalExternals:t,...r}).then(s=>{var d;if(s.errors.length>0||s.buildError){this.buildState$.next(3),this.buildResult$.next(s);return}if(this.buildState$.next(4),((d=this.buildResult$.getValue())==null?void 0:d.hash)===s.hash)return;this.buildResult$.next(s);const{css:u,js:l,globalExternals:c}=s;this.previewer.updateSources({globals:c}),this.previewer.updateSources({scripts:[{id:"externals",content:`var module = {exports: { default: {} }};
          function require (name) {
            var value = module.exports[name] || (module.exports.default ? module.exports.default[name] : null);
            if (value) {
              return value;
            }
          
            throw new Error("module not found: " + name);
          }
          
          ${g.template.externals.cjsCode}
            `},{id:"build",content:l??""}],styles:[{id:"build",content:u??""}],globals:c})})}destroy(){o(this,$).unsubscribe(),this.editor.dispose(),this.previewer.dispose()}getEntryPathRelativeCwd(){return this.explore.relative(o(this,y).entry)}};q=new WeakMap,F=new WeakMap,$=new WeakMap,y=new WeakMap,m(k,q,new Map);let le=k;const ut=e=>se.createElement(Ge.Provider,{value:e.value},e.children),gr=se.memo(e=>{const{entry:t,globalExternals:n,buildInputPattern:r,directoryTreePathsPattern:i,cwd:s,buildOptions:a,children:u}=e,l=de.useMemo(()=>le.create({cwd:s,entry:t,globalExternals:n,buildInputPattern:r,buildOptions:a,directoryTreePathsPattern:i}),[r,n,t,a,i,s]);return se.createElement(ut,{value:l,children:u})},(e,t)=>{const n=["globalExternals","buildOptions","children"];return Object.keys(e).every(r=>n.includes(r)?e[r]===t[r]:JSON.stringify(e[r])===JSON.stringify(t[r]))});ut.__docgenInfo={description:"",methods:[],displayName:"PlaygroundProvider",props:{value:{required:!0,tsType:{name:"Playground"},description:""}}};gr.__docgenInfo={description:"",methods:[],displayName:"PlaygroundProviderBuilder",props:{globalExternals:{required:!1,tsType:{name:"Record",elements:[{name:"string"},{name:"any"}],raw:"Record<string, any>"},description:""},entry:{required:!1,tsType:{name:"string"},description:""},buildInputPattern:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:`The input of esbuild, can be glob pattern
@default  [
        join(options.cwd, "**\\/*"),
        "/node_modules\\/**\\/*.js",
      ]`},buildOptions:{required:!1,tsType:{name:"Omit",elements:[{name:"IBuildOptions"},{name:"union",raw:'"entry" | "input" | "globalExternals"',elements:[{name:"literal",value:'"entry"'},{name:"literal",value:'"input"'},{name:"literal",value:'"globalExternals"'}]}],raw:'Omit<IBuildOptions, "entry" | "input" | "globalExternals">'},description:"@default {}"},directoryTreePathsPattern:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:"@default [join(options.cwd, '**\\/*')]"},cwd:{required:!0,tsType:{name:"string"},description:'@default "/"'},children:{required:!1,tsType:{name:"ReactNode"},description:""}}};export{gr as P,Le as f,xr as u};
